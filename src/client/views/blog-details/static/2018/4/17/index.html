<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8">
  <title>Wue 双向绑定实现原理</title>
</head>
<body>
<div id="app">
  <input type="text" w-model="message"/>
  <p>我会改变：<span id="message">message</span></p>
</div>
<script>
  // A.定义一个空对象, 获取被w-model设置的input
  let obj = {};
  let prop = document.querySelector('[w-model]').getAttribute('w-model');

  // 模板引擎函数
  let whtml = function (source, data) {
    let match;
    let reg = /{{(.+?)}}/g;
    while ((match = reg.exec(source)) !== null) {
      if (match[1]) {
        match[1] = match[1].replace(/\s/g, '');
        source = source.replace(match[0], data)
      } else {
        source = source.replace(match[0], '')
      }
    }
    return source
  };

  // B.精髓所在
  Object.defineProperty(obj, prop, {
    get: function () {
      return obj;
    },
    set: function (newValue) {
      document.querySelector('[w-model=message]').value = newValue;
      // let app = document.getElementById('app');
      // app.innerHTML = whtml(app.innerHTML, newValue);
      document.getElementById('message').innerHTML = newValue;
    }
  });

  // C.添加input事件监听
  document.addEventListener('input', function (e) {
    obj[prop] = e.target.value;
  });
</script>
</body>
</html>
